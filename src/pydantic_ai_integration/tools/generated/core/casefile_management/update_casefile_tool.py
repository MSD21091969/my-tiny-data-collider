"""Auto-generated tool: update_casefile_tool

Generated from: config/tools/core/casefile_management/update_casefile_tool.yaml
DO NOT EDIT THIS FILE MANUALLY - Changes will be overwritten

This tool is part of the pydantic_ai_integration tool engineering foundation.
It was generated by the Tool Factory and automatically registered with MANAGED_TOOLS.
"""
from pydantic import BaseModel, Field
from typing import Dict, Any, Optional, List
from src.pydantic_ai_integration.tool_decorator import register_mds_tool
from src.pydantic_ai_integration.dependencies import MDSContext


class UpdatecasefiletoolParams(BaseModel):
    """Parameters for update_casefile_tool.
    
    Update casefile metadata including title, description, and tags
    """
    casefile_id: str = Field(..., description="Unique identifier of the casefile to update", min_length=1)
    title: Optional[str] = Field(None, description="Updated title for the casefile", min_length=1, max_length=200)
    description: Optional[str] = Field(None, description="Updated description", max_length=5000)
    tags: Optional[List[Any]] = Field(None, description="Updated list of tags (replaces existing tags)", max_length=20)
    metadata: Optional[Dict[str, Any]] = Field(None, description="Updated metadata (merges with existing)")

    class Config:
        json_schema_extra = {
            "examples": [
                {
                    "casefile_id": 'cf_abc123',                    "title": 'RESOLVED: Support Case #12345',                    "description": 'Investigation completed with findings documented',                    "tags": ['closed', 'resolved'],                    "metadata": {'resolution': 'complete', 'closed_date': '2025-10-06'}                }
            ]
        }


@register_mds_tool(
    name="update_casefile_tool",
    display_name="Update Casefile",
    description="Update casefile metadata including title, description, and tags",
    category="workspace",
    version="1.0.0",
    tags=['casefile', 'crud', 'workspace', 'update'],
    enabled=True,
    requires_auth=True,
    required_permissions=['casefiles:write'],
    requires_casefile=True,
    timeout_seconds=30,
    params_model=UpdatecasefiletoolParams,
    session_policies={'requires_active_session': True, 'allow_new_session': False, 'allow_session_resume': True, 'session_event_type': 'request', 'log_request_payload': True, 'log_full_response': True},
    casefile_policies={'requires_casefile': True, 'allowed_casefile_states': ['active'], 'create_if_missing': False, 'enforce_access_control': True, 'audit_casefile_changes': True},
    audit_config={'success_event': 'casefile_updated', 'failure_event': 'casefile_update_failed', 'log_response_fields': ['casefile_id', 'title'], 'redact_fields': [], 'emit_casefile_event': True},
)
async def update_casefile_tool(
    ctx: MDSContext,
    casefile_id: str,    title: str = None,    description: str = None,    tags: List[Any] = None,    metadata: Dict[str, Any] = None) -> Dict[str, Any]:
    """Update casefile metadata including title, description, and tags
    
    Args:
        ctx: MDSContext with user_id, session_id, etc.
        casefile_id: Unique identifier of the casefile to update
        title: Updated title for the casefile
        description: Updated description
        tags: Updated list of tags (replaces existing tags)
        metadata: Updated metadata (merges with existing)
    
    Returns:
        Dict containing execution results
    """
    # Register event for audit trail
    event_id = ctx.register_event(
        "update_casefile_tool",
        {
            "casefile_id": casefile_id,            "title": title,            "description": description,            "tags": tags,            "metadata": metadata        }
    )
    
    # API call implementation - inherit DTOs from method definition
    # Import method's request/response models
    from src.casefileservice.service import CasefileService
    from src.pydantic_models.operations.casefile_ops import UpdateCasefileRequest
    from src.pydantic_models.operations.casefile_ops import UpdateCasefileResponse
    
    # Initialize service (dependency injection will provide actual instance)
    service = CasefileService()
    
    # Build request using method's DTO
    request = UpdateCasefileRequest(
        user_id=ctx.user_id,
        session_id=ctx.session_id,
        context=ctx.model_dump(),
        payload={
            "casefile_id": casefile_id,            "title": title,            "description": description,            "tags": tags,            "metadata": metadata        }
    )
    response = await service.update_casefile(request=request)
    
    # Extract result from response using method's DTO
    result = response.payload.model_dump() if hasattr(response.payload, 'model_dump') else response.payload
    
    
    
    # Update audit trail
    if ctx.tool_events:
        last_event = ctx.tool_events[-1]
        last_event.result_summary = {
            "status": "success",
            "result_preview": str(result)[:100]
        }
        last_event.status = "success"
    
    return result